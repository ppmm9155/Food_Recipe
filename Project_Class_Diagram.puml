@startuml
' 다이어그램의 점들을 숨겨 깔끔하게 만듭니다.
hide circle
' 선이 직각으로 꺾이도록 설정하여 보기 좋게 만듭니다.
skinparam linetype ortho

title Food Recipe 앱 클래스 다이어그램 (MVP 아키텍처)

package "com.example.food_recipe" {

    package "유틸리티" {
        class AutoLoginManager {
            + isLoggedIn(Context) : boolean
            + setAutoLogin(Context, boolean)
            + clearForceReLoginOnce(Context)
            + logout(Context)
        }
        class ValidationUtils {
            + validateEmail(String) : boolean
            + validatePassword(String) : boolean
            + validateUsername(String) : boolean
            + normalizeEmail(String) : String
        }
        class SimpleWatcher {
            + beforeTextChanged()
            + onTextChanged()
            + afterTextChanged()
        }
    }

    package "스플래시 화면" {
        interface SplashContract.View
        interface SplashContract.Presenter
        interface SplashContract.Model {
            interface Callback
        }

        class SplashActivity {
            - presenter: SplashContract.Presenter
            + onCreate()
            + onDestroy()
            + navigateToMain()
            + navigateToLogin()
            + showLoading(boolean)
            + log(String)
        }
        class SplashPresenter {
            - model: SplashContract.Model
            - viewRef: WeakReference<SplashContract.View>
            + SplashPresenter(SplashContract.Model)
            + attach(SplashContract.View)
            + start()
            + detach()
        }
        class SplashModel {
            - appContext: Context
            + SplashModel(Context)
            + canProceedToMain(Callback)
        }

        SplashActivity ..|> SplashContract.View : 구현
        SplashPresenter ..|> SplashContract.Presenter : 구현
        SplashModel ..|> SplashContract.Model : 구현
        SplashContract.Model ..> SplashContract.Model.Callback : 사용 >

        SplashActivity -- SplashPresenter : 사용 >
        SplashPresenter -- SplashModel : 사용 >
        SplashModel -- AutoLoginManager : 사용 >
        SplashModel -- FirebaseAuth : 사용 >
    }

    package "로그인" {
        interface LoginContract.View
        interface LoginContract.Presenter
        interface LoginContract.Model {
            interface AuthCallback
            interface FetchCallback
        }

        class LoginActivity {
            - tilEmail, tilPassword: TextInputLayout
            - etEmail, etPassword: TextInputEditText
            - cbAutoLogin: MaterialCheckBox
            - btnLogin: Button
            - presenter: LoginContract.Presenter
            + onCreate()
            + onDestroy()
            + showEmailError(String)
            + showPasswordError(String)
            + showWrongPassword()
            + showAmbiguous()
            + clearEmailError()
            + clearPasswordError()
            + toast(String)
            + setUiEnabled(boolean)
            + navigateToHome()
            + onLoginSuccess(boolean)
        }
        class LoginPresenter {
            - view: LoginContract.View
            - model: LoginContract.Model
            + LoginPresenter(LoginContract.View, LoginContract.Model)
            + attemptLogin(String, String, boolean)
            + isAmbiguous(String, Exception) : boolean
            + refineAmbiguousWithFetch(String)
            + detachView()
        }
        class LoginModel {
            - mAuth: FirebaseAuth
            + signInWithEmail(String, String, AuthCallback)
            + fetchSignInMethods(String, FetchCallback)
        }

        LoginActivity ..|> LoginContract.View : 구현
        LoginPresenter ..|> LoginContract.Presenter : 구현
        LoginModel ..|> LoginContract.Model : 구현
        LoginContract.Model ..> LoginContract.Model.AuthCallback : 사용 >
        LoginContract.Model ..> LoginContract.Model.FetchCallback : 사용 >

        LoginActivity -- LoginPresenter : 사용 >
        LoginPresenter -- LoginModel : 사용 >
        LoginPresenter -- ValidationUtils : 사용 >
        LoginModel -- FirebaseAuth : 사용 >
        LoginActivity -- SimpleWatcher : 사용 >
    }

    package "회원가입" {
        interface JoinContract.View
        interface JoinContract.Presenter
        interface JoinContract.Model {
            interface UsernameCallback
            interface EmailCallback
            interface RegisterCallback
        }

        class JoinActivity {
            - tilId, tilEmail, tilPassword, tilPasswordConfirm: TextInputLayout
            - etId, etEmail, etPassword, etPasswordConfirm: TextInputEditText
            - btnCheckId, btnVerifyEmail, btnRegister: MaterialButton
            - presenter: JoinContract.Presenter
            + onCreate()
            + onDestroy()
            + showIdError(String)
            + showIdOk(String)
            + showIdHelper(String)
            + showEmailError(String)
            + showEmailOk(String)
            + showEmailHelper(String)
            + showPasswordError(String)
            + showPasswordConfirmError(String)
            + showPasswordConfirmOk(String)
            + clearErrorOnId()
            + clearErrorOnEmail()
            + clearErrorOnPassword()
            + clearErrorOnPasswordConfirm()
            + toast(String)
            + setUiEnabled(boolean)
            + navigateToLogin()
        }
        class JoinPresenter {
            - view: JoinContract.View
            - model: JoinContract.Model
            + JoinPresenter(JoinContract.View, JoinContract.Model)
            + checkUsernameAvailability(String)
            + checkEmailAvailability(String)
            + attemptRegister(String, String, String, String)
            + onUsernameEdited()
            + detachView()
        }
        class JoinModel {
            - mAuth: FirebaseAuth
            - db: FirebaseFirestore
            + checkUsernameAvailability(String, UsernameCallback)
            + checkEmailAvailability(String, EmailCallback)
            + createUserThenSaveProfile(String, String, String, RegisterCallback)
        }

        JoinActivity ..|> JoinContract.View : 구현
        JoinPresenter ..|> JoinContract.Presenter : 구현
        JoinModel ..|> JoinContract.Model : 구현
        JoinContract.Model ..> JoinContract.Model.UsernameCallback : 사용 >
        JoinContract.Model ..> JoinContract.Model.EmailCallback : 사용 >
        JoinContract.Model ..> JoinContract.Model.RegisterCallback : 사용 >

        JoinActivity -- JoinPresenter : 사용 >
        JoinPresenter -- JoinModel : 사용 >
        JoinPresenter -- ValidationUtils : 사용 >
        JoinModel -- FirebaseAuth : 사용 >
        JoinModel -- FirebaseFirestore : 사용 >
        JoinActivity -- SimpleWatcher : 사용 >
    }

    package "아이디 찾기" {
        interface FindIdContract.View
        interface FindIdContract.Presenter
        interface FindIdContract.Model {
            interface Callback
        }

        class FindIdActivity {
            - Fi_editTextEmail: EditText
            - Fi_buttonVerify, Fi_buttonLogin: Button
            - presenter: FindIdContract.Presenter
            + onCreate()
            + onDestroy()
            + showEmailSentMessage()
            + showErrorMessage(String)
            + showLoginRedirectMessage()
        }
        class FindIdPresenter {
            - view: FindIdContract.View
            - model: FindIdContract.Model
            + FindIdPresenter(FindIdContract.View, FindIdContract.Model)
            + onVerifyEmailClicked(String)
            + onLoginClicked()
            + detachView()
        }
        class FindIdModel {
            - mAuth: FirebaseAuth
            + sendVerificationEmail(String, Callback)
        }

        FindIdActivity ..|> FindIdContract.View : 구현
        FindIdPresenter ..|> FindIdContract.Presenter : 구현
        FindIdModel ..|> FindIdContract.Model : 구현
        FindIdContract.Model ..> FindIdContract.Model.Callback : 사용 >

        FindIdActivity -- FindIdPresenter : 사용 >
        FindIdPresenter -- FindIdModel : 사용 >
        FindIdPresenter -- ValidationUtils : 사용 >
        FindIdModel -- FirebaseAuth : 사용 >
    }

    package "비밀번호 찾기" {
        interface FindPsContract.View
        interface FindPsContract.Presenter
        interface FindPsContract.Model {
            interface Callback
        }

        class FindPsActivity {
            - Fs_buttonVerify: Button
            - Fs_editTextEmail: EditText
            - presenter: FindPsContract.Presenter
            + onCreate()
            + onDestroy()
            + showEmailEmptyError()
            + showResetEmailSentMessage()
            + showResetEmailFailedMessage()
            + navigateToLogin()
        }
        class FindPsPresenter {
            - view: FindPsContract.View
            - model: FindPsContract.Model
            + FindPsPresenter(FindPsContract.View, FindPsContract.Model)
            + onVerifyEmailClicked(String)
            + detachView()
        }
        class FindPsModel {
            - mAuth: FirebaseAuth
            + sendPasswordResetEmail(String, Callback)
        }

        FindPsActivity ..|> FindPsContract.View : 구현
        FindPsPresenter ..|> FindPsContract.Presenter : 구현
        FindPsModel ..|> FindPsContract.Model : 구현
        FindPsContract.Model ..> FindPsContract.Model.Callback : 사용 >

        FindPsActivity -- FindPsPresenter : 사용 >
        FindPsPresenter -- FindPsModel : 사용 >
        FindPsModel -- FirebaseAuth : 사용 >
    }

    package "메인 화면" {
        interface MainContract.View
        interface MainContract.Presenter
        interface MainContract.Model {
            interface LogoutCallback
            interface LoginStatusCallback
        }

        class MainActivity {
            - presenter: MainContract.Presenter
            + onCreate()
            + onStart()
            + onDestroy()
            + onCreateOptionsMenu()
            + onOptionsItemSelected()
            + showLogoutMessage(String)
            + navigateToLogin()
            + setLogoutEnabled(boolean)
        }
        class MainPresenter {
            - model: MainContract.Model
            - viewRef: WeakReference<MainContract.View>
            + MainPresenter(Context)
            + MainPresenter(MainContract.Model)
            + attach(MainContract.View)
            + detach()
            + start()
            + onLogoutClicked()
        }
        class MainModel {
            - appContext: Context
            + MainModel(Context)
            + logout(LogoutCallback)
            + checkLoginStatus(LoginStatusCallback)
        }
        class HomeFragment {
            - title: TextView
            + onCreateView()
            - loadGreeting()
            - applyUsername(DocumentSnapshot)
        }

        MainActivity ..|> MainContract.View : 구현
        MainPresenter ..|> MainContract.Presenter : 구현
        MainModel ..|> MainContract.Model : 구현
        MainContract.Model ..> MainContract.Model.LogoutCallback : 사용 >
        MainContract.Model ..> MainContract.Model.LoginStatusCallback : 사용 >

        MainActivity -- MainPresenter : 사용 >
        MainPresenter -- MainModel : 사용 >
        MainModel -- AutoLoginManager : 사용 >
        MainModel -- FirebaseAuth : 사용 >

        MainActivity o-- HomeFragment : 포함 >
        HomeFragment -- FirebaseAuth : 사용 >
        HomeFragment -- FirebaseFirestore : 사용 >
    }
}

' 전역 화면 이동 관계
SplashActivity --> LoginActivity : 이동 >
SplashActivity --> MainActivity : 이동 >
LoginActivity --> JoinActivity : 이동 >
LoginActivity --> FindIdActivity : 이동 >
LoginActivity --> FindPsActivity : 이동 >
MainActivity --> LoginActivity : 이동 >
FindIdActivity --> LoginActivity : 이동 >
FindPsActivity --> LoginActivity : 이동 >

@enduml